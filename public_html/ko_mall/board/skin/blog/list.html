<?
//페이징 변수
if (!$start) $start = 0;
$scale = $board[list_limit]; // 리스트 수
$page_scale	= 10; // 페이징 수

//검색
if($keyword){

	if($search_key == ""){
		$search_key = "title";
	}
	$WHERE .= " AND $search_key LIKE '%$keyword%'";
}

if($category){
	$WHERE .= " AND category = '$category'";
}

//리스트
$total_query = "SELECT * FROM $board_id WHERE 1=1 $WHERE ORDER BY notice DESC, reg_date DESC, no DESC";
$total_result = mysqli_query($connect, $total_query);
$total = mysqli_num_rows($total_result);

$query = "SELECT * FROM $board_id WHERE 1=1  $WHERE ORDER BY notice DESC, ref_group DESC, depth ASC, no DESC LIMIT $start, $scale";
$result = mysqli_query($connect,$query);
?>
<ul class="blogList">
	<? if($total > 0) { ?>
		<? $f_no = $total - $start; ?>
		<? while($row = mysqli_fetch_array($result)){ ?>
			<? 
				$date_array = explode("-",  $row[reg_date]); 
				if($row[notice] == "Y") { 
					$no_title = "<em class='notice'>공지</em>";
					$f_no--;
				} else {
					$no_title = $f_no--;
				}
				$title_reply = "";

				//현재글 
				if($no == $row[no]){ 
					$total_txt = "<img src=\"/img/now_gul.gif\" />";
				}

				//7일 new 아이콘 
				if ($row[reg_date] >= date("Y-m-d", strtotime("-7 day"))) {
					 $title_reply = "<em class=\"new\">새글</em>";	
				} else unset($title_reply);

				//depth 가 1이상이면 답변 아이콘
				if($row[depth] > 0){
					//$padding_style = $row[depth] * 40;
					$title_reply = "<em class='reply'>답변</em>";
				}

				$reply_query_count = "SELECT * FROM board_comment WHERE ref_board_no = '$row[no]' AND board_id = '$board_id'";
				$reply_count_result = mysqli_query($connect, $reply_query_count);
				$reply_count = mysqli_num_rows($reply_count_result);

				if($reply_count > 0){
					$reply_query = "SELECT * FROM board_comment  ref_board_no = '$row[no]' AND board_id = '$board_id ORDER BY reg_date DESC";
					$reply_result = mysqli_query($connect, $reply_query);
				}

				$review_text = strip_tags($row[comments]);
				$review_text = str_replace("&nbsp;", " ", $review_text);

			?>
			
				<!-- 반복 -->
				<li>
					<a href="<?=$common_queryString?>&amp;mode=view&amp;no=<?=$row[no]?>">
							<? if($row[file_1]){
								$ext = end(explode(".", strtolower($row[file_1])));
								if($ext == "jpg" || $ext == "png" || $ext == "jpeg" || $ext == "bmp"){ ?>
								<span class="img">
									<img src="/upload/<?=$board_id?>/<?=rawurlencode($row[file_1])?>" alt=""/>
								</span>
								<? } else { ?>
									<img src="/ko_mall/images/board/no_image.gif" alt=""/>
							<?	} 
							} else { ?>
							
							<? } ?>
						<!-- 제목 -->
						<em>	
							<? if($board[use_category] == "Y" || $board[use_category] == "I") { echo "[".$row[category]."] "; } ?>
							<?=$row[title]?><? if($board[use_comment] == "Y" ) { ?><i style="display:inline;"> [<?=$reply_count?>]</i><? } ?></em>
						<p><?=mb_strimwidth($review_text,'0','260','...','utf-8')?></p>		
						<i><?=reset(explode(" ", $row[reg_date]))?></i>
					</a>
				</li>
		<? } ?>
	<? } else { ?>
		<li>등록된 글이 없습니다.</li>
	<? } ?>
</ul>
<!-- 검색 및 버튼 -->
<? include "search.html"; ?>
<!-- 검색 및 버튼 -->
	
<!-- page -->
<? include "paging.html"; ?>
<!-- //page -->


