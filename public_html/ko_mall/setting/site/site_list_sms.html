<?
$query = "SELECT * FROM koweb_sms_config ORDER BY no DESC";
$result = mysqli_query($connect, $query);
$row = mysqli_fetch_array($result);
?>

<nav class="lnb small" id="pro01">
	<!-- 선택시 a태그 class="on" -->
	<ul>
		<li><a href="/ko_mall/index.html?type=setting&core=manager_setting&manager_type=site">사이트설정</a></li>
		<li><a href="/ko_mall/index.html?type=setting&core=manager_setting&manager_type=site&mode=mall">사업자정보 설정</a></li>
		<li><a href="/ko_mall/index.html?type=setting&core=manager_setting&manager_type=site&mode=pay">구매설정</a></li>
		<li><a href="/ko_mall/index.html?type=setting&core=manager_setting&manager_type=site&mode=info">이용안내설정</a></li>
		<li><a href="/ko_mall/index.html?type=setting&core=manager_setting&manager_type=site&mode=private">개인정보처리방침설정</a></li>
		<li><a href="/ko_mall/index.html?type=setting&core=manager_setting&manager_type=site&mode=agreement">이용약관설정</a></li>
		<li><a href="/ko_mall/index.html?type=setting&core=manager_setting&manager_type=site&mode=sms" class="on">SMS문구 설정</a></li>
	</ul>
</nav>

<div class="box pd">
<h2>SMS문구설정</h2>
<form method='post' action="<?=$common_queryString?>" enctype='multipart/form-data'>
<input type="hidden" name="mode" value="write_proc" />
<input type="hidden" name="tmode" value="<?=$mode?>" />
<input type="hidden" name="no" value="<?=$no?>" />

	<div class="box_title">
		<span class="txt_blue">SMS작성 주의</span>
		<p style="margin-top:5px;">SMS의 글자수는 65바이트 이하로 권장드립니다. 그이상의 경우 SMS 차감건수가 늘어날수 있습니다. <br /><br />내용작성 후 필히 글자수 체크하기를 통해 바이트를 확인하세요<br /><br />{아이디} {주문번호} {주문금액} {입금액} {택배회사} {운송장번호}</p>
	</div>
	<table class="bbsView mt20">
		<caption>SMS문구설정</caption>
		<colgroup>
			<col style="width:15%"/>
			<col style="width:40%"/>
			<col style="width:15%"/>
			<col/>				
		</colgroup>
		<tbody>
			<tr>
				<th scope="row">SMS 사용여부</th>
				<td>
					<div class="designRadio">
						<input type="radio" name="sms_use" value="Y" id="sms_useY" /><label for="sms_useY">사용</label>
						<input type="radio" name="sms_use" value="N" id="sms_useN" /><label for="sms_useN">미사용</label>
						<span class="info red">사이트 설정에 id와 key값이 입력되어있어야 합니다.</span> 
					</div>
				</td>			
				<th scope="row">발신번호</th>
				<td><input type="text" name="send_no" value="<?=$row[send_no]?>" /></td>
			</tr>			
			<tr>
				<th scope="row">회원가입시 고객 발송
					<div data-content-type="join_sms" <? if($row[join_sms] != "Y") { ?> style="display:none;" <? } ?>>
						<input type="button" class="button sm gray" value="글자수 체크하기" data-check-length="join_sms_content" />
					</div>
				</th>
				<td colspan="3">
					<div class="designRadio">
						<input type="radio" name="join_sms" value="Y" id="join_smsY" /><label for="join_smsY">사용</label>
						<input type="radio" name="join_sms" value="N" id="join_smsN" /><label for="join_smsN">미사용</label>
					</div>
					<div data-content-type="join_sms" <? if($row[join_sms] != "Y") { ?> style="display:none;" <? } ?>>
						<textarea name="join_sms_content" class="inputFull"><?=$row[join_sms_content]?></textarea>						
					</div>
				</td>
			</tr>
			<tr>
				<th scope="row">주문시 고객발송
					<div data-content-type="cons_sms" <? if($row[cons_sms] != "Y") { ?> style="display:none;" <? } ?>>						
						<input type="button" class="button sm gray" value="글자수 체크하기" data-check-length="cons_sms_content"/>
					</div>
				</th>
				<td colspan="3">
					<div class="designRadio">
						<input type="radio" name="cons_sms" value="Y" id="cons_smsY" /><label for="cons_smsY">사용</label>
						<input type="radio" name="cons_sms" value="N" id="cons_smsN" /><label for="cons_smsN">미사용</label>
					</div>
					<div data-content-type="cons_sms" <? if($row[cons_sms] != "Y") { ?> style="display:none;" <? } ?>>
						<textarea name="cons_sms_content" class="inputFull"><?=$row[cons_sms_content]?></textarea>						
					</div>
				</td>
			</tr>
			<tr>
				<th scope="row">주문시 관리자발송
					<div data-content-type="cons_admin_sms"  <? if($row[cons_admin_sms] != "Y") { ?> style="display:none;" <? } ?>>						
						<input type="button" class="button sm gray" value="글자수 체크하기" data-check-length="cons_admin_sms_content"/>
					</div>
				</th>
				<td colspan="3">
					<div class="designRadio">
						<input type="radio" name="cons_admin_sms" value="Y" id="cons_admin_smsY" /><label for="cons_admin_smsY">사용</label>
						<input type="radio" name="cons_admin_sms" value="N" id="cons_admin_smsN" /><label for="cons_admin_smsN">미사용</label>
					</div>
					<div data-content-type="cons_admin_sms"  <? if($row[cons_admin_sms] != "Y") { ?> style="display:none;" <? } ?>>
						<textarea name="cons_admin_sms_content" class="inputFull"><?=$row[cons_admin_sms_content]?></textarea>
					</div>
				</td>
			</tr>
			<tr>
				<th scope="row">입금확인시 고객발송
					<div data-content-type="deposit_sms"  <? if($row[deposit_sms] != "Y") { ?> style="display:none;" <? } ?>>
						<input type="button" class="button sm gray" value="글자수 체크하기" data-check-length="deposit_sms_content"/>
					</div>
				</th>
				<td colspan="3">
					<div class="designRadio">
						<input type="radio" name="deposit_sms" value="Y" id="deposit_smsY" /><label for="deposit_smsY">사용</label>
						<input type="radio" name="deposit_sms" value="N" id="deposit_smsN" /><label for="deposit_smsN">미사용</label>
					</div>
					<div data-content-type="deposit_sms"  <? if($row[deposit_sms] != "Y") { ?> style="display:none;" <? } ?>>
						<textarea name="deposit_sms_content" class="inputFull"><?=$row[deposit_sms_content]?></textarea>
					</div>
				</td>
			</tr>
			<tr>
				<th scope="row">상품배송시 고객발송
					<div data-content-type="deli_sms" <? if($row[deli_sms] != "Y") { ?> style="display:none;" <? } ?>>
						<input type="button" class="button sm gray" value="글자수 체크하기" data-check-length="deli_sms_content"/>
					</div>
				</th>
				<td colspan="3">
					<div class="designRadio">
						<input type="radio" name="deli_sms" value="Y" id="deli_smsY" /><label for="deli_smsY">사용</label>
						<input type="radio" name="deli_sms" value="N" id="deli_smsN" /><label for="deli_smsN">미사용</label>
					</div>
					<div data-content-type="deli_sms" <? if($row[deli_sms] != "Y") { ?> style="display:none;" <? } ?>>
						<textarea name="deli_sms_content" class="inputFull"><?=$row[deli_sms_content]?></textarea>
					</div>
				</td>
			</tr>
		</tbody>
	</table>
	
	<div class="btn_area">
		<input type="submit" class="button lg" value="설정 저장">
	</div>
</form>
<script type="text/javascript">
	$(function() {
		$("input:radio[name='sms_use']:radio[value='<?=$row[sms_use]?>']").prop("checked",true); 
		$("input:radio[name='deli_sms']:radio[value='<?=$row[deli_sms]?>']").prop("checked",true); 
		$("input:radio[name='deposit_sms']:radio[value='<?=$row[deposit_sms]?>']").prop("checked",true); 
		$("input:radio[name='cons_admin_sms']:radio[value='<?=$row[cons_admin_sms]?>']").prop("checked",true); 
		$("input:radio[name='cons_sms']:radio[value='<?=$row[cons_sms]?>']").prop("checked",true); 
		$("input:radio[name='join_sms']:radio[value='<?=$row[join_sms]?>']").prop("checked",true); 


		$("input[type=radio]").change(function(){
			var key_ = $(this).attr("name");
			var keyword_ = $(this).attr("value");

			if(keyword_ == "Y"){
				$("[data-content-type="+key_+"]").css("display","");
			} else {
				$("[data-content-type="+key_+"]").css("display","none");
			}
		});

		$("[data-check-length]").click(function(){
			
			var contents_ = $("textarea[name="+$(this).data("check-length")+"]").val();
			var bytes_ = 0;
			for(var i = 0; i < contents_.length; i++){
				thisChar = contents_.charAt(i);
				if (escape(thisChar).length > 4) {
					bytes_ += 2;
				} else {
					bytes_++;
				}
			}
			alert("입력하신 필드의 바이트는 "+bytes_+"바이트 입니다.");
		});
	});
</script>